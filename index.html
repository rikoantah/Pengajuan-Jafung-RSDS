<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Pengajuan Jabatan Fungsional RSDS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Segoe UI,Roboto,sans-serif;
  background:#f1f4f8;
}
header{
  background:linear-gradient(135deg,#0f4c81,#083357);
  color:#fff;
  padding:22px 40px;
  font-size:24px;
  font-weight:600;
}
.container{padding:30px 40px}
.search{
  padding:10px;
  width:350px;
  border-radius:8px;
  border:1px solid #cbd5e1;
}
table{
  width:100%;
  margin-top:20px;
  border-collapse:collapse;
  background:#fff;
  box-shadow:0 6px 20px rgba(0,0,0,.08);
}
th,td{
  padding:12px;
  border-bottom:1px solid #e5e7eb;
  font-size:14px;
}
th{
  background:#e9eef4;
  position:sticky;
  top:0;
}
textarea{
  width:100%;
  min-height:60px;
  resize:vertical;
}
button{
  padding:6px 12px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  color:#fff;
}
.save-rsds{background:#0f4c81;}
.save-bkd{background:#9333ea;}
.loading{background:#94a3b8 !important;}
a.folder{
  background:#16a34a;
  color:#fff;
  padding:6px 10px;
  border-radius:6px;
  text-decoration:none;
}
</style>
</head>

<body>
<header>Pengajuan Jabatan Fungsional RSDS</header>

<div class="container">
  <input class="search" id="search" placeholder="Cari Nama Pegawai...">

  <table>
    <thead>
      <tr>
        <th>No</th>
        <th>Nama</th>
        <th>NIP</th>
        <th>HP</th>
        <th>Folder</th>
        <th>Status</th>
        <th>Catatan RSDS</th>
        <th>Aksi</th>
        <th>Catatan BKD</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody id="body"></tbody>
  </table>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbz2hbsTNSkLJ5h98hp7pYybCKOvq7Fs5c0nADZDYxfSANNGZ96oPURdBoLJf9g4dafrWA/exec";
let DATA = [];

fetch(API_URL)
  .then(r=>r.json())
  .then(d=>{
    DATA=d;
    render(DATA);
  });

document.getElementById("search").oninput=e=>{
  const q=e.target.value.toLowerCase();
  render(DATA.filter(d=>d.nama.toLowerCase().includes(q)));
};

function render(data){
  body.innerHTML="";
  data.forEach((d,i)=>{
    body.innerHTML+=`
      <tr>
        <td>${i+1}</td>
        <td>${d.nama}</td>
        <td>${d.nip}</td>
        <td>${d.hp}</td>
        <td>${d.folder?`<a class="folder" target="_blank" href="${d.folder}">Buka</a>`:"-"}</td>
        <td>${d.status}</td>

        <td>
          <textarea id="rsds${d.row}">${d.catatan_rsds}</textarea>
        </td>
        <td>
          <button class="save-rsds" id="btnr${d.row}"
            onclick="save(${d.row},'rsds')">Save</button>
        </td>

        <td>
          <textarea id="bkd${d.row}">${d.catatan_bkd}</textarea>
        </td>
        <td>
          <button class="save-bkd" id="btnb${d.row}"
            onclick="save(${d.row},'bkd')">Save</button>
        </td>
      </tr>`;
  });
}

function save(row,tipe){
  const btn = document.getElementById(
    tipe==="rsds" ? "btnr"+row : "btnb"+row
  );

  btn.classList.add("loading");
  btn.textContent="Saving...";

  const value = document.getElementById(
    tipe==="rsds" ? "rsds"+row : "bkd"+row
  ).value;

  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      row:row,
      tipe:tipe,
      catatan:value
    })
  }).then(()=>{
    btn.classList.remove("loading");
    btn.textContent="Saved âœ“";
    setTimeout(()=>btn.textContent="Save",1200);
  });
}
</script>

</body>
</html>
